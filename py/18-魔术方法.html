<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>魔术方法 | nanarino note</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="shortcut icon" href="./favicon.ico">
    <meta name="description" content="今年的冬天很长吧？然后我最喜欢的赏樱推迟又推……终于，以为到了春天，樱花却突然很快的开了，又很快地凋谢了……这么悔恨的年份根本就没有吧？">
    
    <link rel="preload" href="/markdown-note/assets/css/0.styles.9d4be43c.css" as="style"><link rel="preload" href="/markdown-note/assets/js/app.6b4725cf.js" as="script"><link rel="preload" href="/markdown-note/assets/js/8.ae913670.js" as="script"><link rel="preload" href="/markdown-note/assets/js/1.5bc6bece.js" as="script"><link rel="preload" href="/markdown-note/assets/js/59.d67ff772.js" as="script"><link rel="prefetch" href="/markdown-note/assets/js/10.7e5ef7e5.js"><link rel="prefetch" href="/markdown-note/assets/js/11.301d9dda.js"><link rel="prefetch" href="/markdown-note/assets/js/12.c9b915b3.js"><link rel="prefetch" href="/markdown-note/assets/js/13.84c13ead.js"><link rel="prefetch" href="/markdown-note/assets/js/14.de9f92e2.js"><link rel="prefetch" href="/markdown-note/assets/js/15.8db858c1.js"><link rel="prefetch" href="/markdown-note/assets/js/16.f9ff9ab3.js"><link rel="prefetch" href="/markdown-note/assets/js/17.8259891a.js"><link rel="prefetch" href="/markdown-note/assets/js/18.c614dbf8.js"><link rel="prefetch" href="/markdown-note/assets/js/19.980ac3ed.js"><link rel="prefetch" href="/markdown-note/assets/js/20.8863a63e.js"><link rel="prefetch" href="/markdown-note/assets/js/21.57a11f23.js"><link rel="prefetch" href="/markdown-note/assets/js/22.03d39410.js"><link rel="prefetch" href="/markdown-note/assets/js/23.f0f8c921.js"><link rel="prefetch" href="/markdown-note/assets/js/24.537435dd.js"><link rel="prefetch" href="/markdown-note/assets/js/25.18df36c3.js"><link rel="prefetch" href="/markdown-note/assets/js/26.94fb784f.js"><link rel="prefetch" href="/markdown-note/assets/js/27.ff7e227a.js"><link rel="prefetch" href="/markdown-note/assets/js/28.880bf788.js"><link rel="prefetch" href="/markdown-note/assets/js/29.fe819911.js"><link rel="prefetch" href="/markdown-note/assets/js/3.2b4e5088.js"><link rel="prefetch" href="/markdown-note/assets/js/30.617b866c.js"><link rel="prefetch" href="/markdown-note/assets/js/31.6b692b28.js"><link rel="prefetch" href="/markdown-note/assets/js/32.da8d2239.js"><link rel="prefetch" href="/markdown-note/assets/js/33.6771918f.js"><link rel="prefetch" href="/markdown-note/assets/js/34.af108730.js"><link rel="prefetch" href="/markdown-note/assets/js/35.2acc9aee.js"><link rel="prefetch" href="/markdown-note/assets/js/36.0396717d.js"><link rel="prefetch" href="/markdown-note/assets/js/37.ce048f93.js"><link rel="prefetch" href="/markdown-note/assets/js/38.2b9b2368.js"><link rel="prefetch" href="/markdown-note/assets/js/39.fe09ad3c.js"><link rel="prefetch" href="/markdown-note/assets/js/4.b20bb83b.js"><link rel="prefetch" href="/markdown-note/assets/js/40.f1d7a1ea.js"><link rel="prefetch" href="/markdown-note/assets/js/41.5ddd0a5c.js"><link rel="prefetch" href="/markdown-note/assets/js/42.bebca75e.js"><link rel="prefetch" href="/markdown-note/assets/js/43.a400f188.js"><link rel="prefetch" href="/markdown-note/assets/js/44.f6a81e40.js"><link rel="prefetch" href="/markdown-note/assets/js/45.d3f587cd.js"><link rel="prefetch" href="/markdown-note/assets/js/46.9eba565c.js"><link rel="prefetch" href="/markdown-note/assets/js/47.0ec6dcc4.js"><link rel="prefetch" href="/markdown-note/assets/js/48.b6a57045.js"><link rel="prefetch" href="/markdown-note/assets/js/49.aada9f7d.js"><link rel="prefetch" href="/markdown-note/assets/js/5.ecff997d.js"><link rel="prefetch" href="/markdown-note/assets/js/50.a00306d8.js"><link rel="prefetch" href="/markdown-note/assets/js/51.913b147d.js"><link rel="prefetch" href="/markdown-note/assets/js/52.5bf18659.js"><link rel="prefetch" href="/markdown-note/assets/js/53.d13d2d5e.js"><link rel="prefetch" href="/markdown-note/assets/js/54.ccbd1361.js"><link rel="prefetch" href="/markdown-note/assets/js/55.9c0605ed.js"><link rel="prefetch" href="/markdown-note/assets/js/56.60b2ec97.js"><link rel="prefetch" href="/markdown-note/assets/js/57.9079f526.js"><link rel="prefetch" href="/markdown-note/assets/js/58.05e49f07.js"><link rel="prefetch" href="/markdown-note/assets/js/6.b1cd3e37.js"><link rel="prefetch" href="/markdown-note/assets/js/60.bc125d4b.js"><link rel="prefetch" href="/markdown-note/assets/js/61.bd66fbd8.js"><link rel="prefetch" href="/markdown-note/assets/js/62.8d572a3f.js"><link rel="prefetch" href="/markdown-note/assets/js/63.3e4901bd.js"><link rel="prefetch" href="/markdown-note/assets/js/64.2c4a1939.js"><link rel="prefetch" href="/markdown-note/assets/js/65.851998f4.js"><link rel="prefetch" href="/markdown-note/assets/js/66.5a5b57c3.js"><link rel="prefetch" href="/markdown-note/assets/js/67.edb6708e.js"><link rel="prefetch" href="/markdown-note/assets/js/68.ac17d7bd.js"><link rel="prefetch" href="/markdown-note/assets/js/69.a252ce8d.js"><link rel="prefetch" href="/markdown-note/assets/js/7.f3f49ad4.js"><link rel="prefetch" href="/markdown-note/assets/js/70.5f91924f.js"><link rel="prefetch" href="/markdown-note/assets/js/71.0d76d528.js"><link rel="prefetch" href="/markdown-note/assets/js/72.f74de48d.js"><link rel="prefetch" href="/markdown-note/assets/js/73.5cd271e6.js"><link rel="prefetch" href="/markdown-note/assets/js/74.f06cb058.js"><link rel="prefetch" href="/markdown-note/assets/js/75.ad72f980.js"><link rel="prefetch" href="/markdown-note/assets/js/76.73b2046c.js"><link rel="prefetch" href="/markdown-note/assets/js/77.0277ee94.js"><link rel="prefetch" href="/markdown-note/assets/js/78.617858d7.js"><link rel="prefetch" href="/markdown-note/assets/js/79.e76450e0.js"><link rel="prefetch" href="/markdown-note/assets/js/80.b26d2698.js"><link rel="prefetch" href="/markdown-note/assets/js/81.eea10a36.js"><link rel="prefetch" href="/markdown-note/assets/js/82.ee8110b7.js"><link rel="prefetch" href="/markdown-note/assets/js/83.3188d281.js"><link rel="prefetch" href="/markdown-note/assets/js/9.f19db848.js">
    <link rel="stylesheet" href="/markdown-note/assets/css/0.styles.9d4be43c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown-note/" class="home-link router-link-active"><!----> <span class="site-name">nanarino note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="about" class="dropdown-title"><span class="title">about</span> <span class="arrow down"></span></button> <button type="button" aria-label="about" class="mobile-dropdown-title"><span class="title">about</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/kogawananari" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link">
  JavaScript
</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link router-link-active">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="about" class="dropdown-title"><span class="title">about</span> <span class="arrow down"></span></button> <button type="button" aria-label="about" class="mobile-dropdown-title"><span class="title">about</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/kogawananari" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>起步</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>函数</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>面向对象</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/markdown-note/py/16-类和对象.html" class="sidebar-link">类和对象</a></li><li><a href="/markdown-note/py/17-封装和继承.html" class="sidebar-link">封装和继承</a></li><li><a href="/markdown-note/py/18-魔术方法.html" class="active sidebar-link">魔术方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown-note/py/18-魔术方法.html#字符串相关" class="sidebar-link">字符串相关</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/18-魔术方法.html#索引相关" class="sidebar-link">索引相关</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/18-魔术方法.html#实例化相关" class="sidebar-link">实例化相关</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/18-魔术方法.html#调用相关" class="sidebar-link">调用相关</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/18-魔术方法.html#对象属性相关" class="sidebar-link">对象属性相关</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/18-魔术方法.html#运算符相关" class="sidebar-link">运算符相关</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/18-魔术方法.html#其他内置函数有关" class="sidebar-link">其他内置函数有关</a></li></ul></li><li><a href="/markdown-note/py/19-多态和泛型.html" class="sidebar-link">多态和泛型</a></li><li><a href="/markdown-note/py/20-模块和包.html" class="sidebar-link">模块和包</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>WEB相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂项模块</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="魔术方法"><a href="#魔术方法" class="header-anchor">#</a> 魔术方法</h1> <blockquote><p>在Python中,所有以“__”双下划线包起来的方法,都统称为“Magic Method”,中文称:&quot;魔术方法&quot;</p></blockquote> <p>这里只补充内置(类)方法中的魔术方法</p> <h2 id="字符串相关"><a href="#字符串相关" class="header-anchor">#</a> 字符串相关</h2> <p>改变对象的字符串显示的魔术方法</p> <ul><li>用于控制台输出显示的<code>__str__</code></li> <li>用于程序调试显示的<code>__repr__</code></li> <li>自定制格式化字符串<code>__format__</code></li></ul> <p>内置函数<code>str</code>或者<code>print</code> 会调用 <code>obj.__str__()</code><br>
内置函数<code>repr</code>会调用 <code>obj.__repr__()</code><br>
如果<code>__str__</code>没有被定义,那么就会使用<code>__repr__</code>来代替输出（这个很容易导致递归需要留意）</p> <p>注意：这俩方法的返回值必须是字符串,否则抛出异常</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#_*_coding:utf-8_*_</span>
format_dict<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'nat'</span><span class="token punctuation">:</span><span class="token string">'{obj.name}-{obj.addr}-{obj.type}'</span><span class="token punctuation">,</span><span class="token comment">#学校名-学校地址-学校类型</span>
    <span class="token string">'tna'</span><span class="token punctuation">:</span><span class="token string">'{obj.type}:{obj.name}:{obj.addr}'</span><span class="token punctuation">,</span><span class="token comment">#学校类型:学校名:学校地址</span>
    <span class="token string">'tan'</span><span class="token punctuation">:</span><span class="token string">'{obj.type}/{obj.addr}/{obj.name}'</span><span class="token punctuation">,</span><span class="token comment">#学校类型/学校地址/学校名</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">School</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">,</span>addr<span class="token punctuation">,</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name<span class="token operator">=</span>name
        self<span class="token punctuation">.</span>addr<span class="token operator">=</span>addr
        self<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">type</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'School(%s,%s)'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span>self<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'(%s,%s)'</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span>self<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__format__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> format_spec<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># if format_spec</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> format_spec <span class="token keyword">or</span> format_spec <span class="token keyword">not</span> <span class="token keyword">in</span> format_dict<span class="token punctuation">:</span>
            format_spec<span class="token operator">=</span><span class="token string">'nat'</span>
        fmt <span class="token operator">=</span> format_dict<span class="token punctuation">[</span>format_spec<span class="token punctuation">]</span>
        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>obj<span class="token operator">=</span>self<span class="token punctuation">)</span>

s1 <span class="token operator">=</span> School<span class="token punctuation">(</span><span class="token string">'oldboy1'</span><span class="token punctuation">,</span><span class="token string">'北京'</span><span class="token punctuation">,</span><span class="token string">'私立'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'from repr: '</span><span class="token punctuation">,</span><span class="token builtin">repr</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'from str: '</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">'nat'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">'tna'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">'tan'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">format</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span><span class="token string">'asfdasdffd'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><code>%s</code>和<code>%r</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'str : class B'</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'repr : class B'</span>

b<span class="token operator">=</span>B<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s'</span><span class="token operator">%</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%r'</span><span class="token operator">%</span>b<span class="token punctuation">)</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">在之前章节中提到的：</p> <p>在基础字符串类型中，魔术方法<code>__repr__</code>返回的是原始字符串类型。<br>
而基础的容器类型中<code>__str__</code>对容器内部成员一般是用的<code>__repr__</code>方法。</p></div> <p>例如：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token string">'\\'</span><span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'\\'</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token string">'\\'</span><span class="token punctuation">.</span>__repr__<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">&quot;'\\\\'&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'\\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">&quot;['\\\\']&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre></div><p>重写<code>__repr__()</code>方法使容器外访问和容器内偏差</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> colorama <span class="token keyword">import</span> init<span class="token punctuation">,</span> Fore
init<span class="token punctuation">(</span>autoreset <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Color_str</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    color <span class="token operator">=</span> <span class="token string">'WHITE'</span>
    <span class="token keyword">def</span> <span class="token function">set_color</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>color<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> color
        <span class="token keyword">return</span> self
    
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''注意不要递归'''</span>
        <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>Fore<span class="token punctuation">,</span> self<span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{</span>Fore<span class="token punctuation">.</span>RESET<span class="token punctuation">}</span></span><span class="token string">'</span></span>
        
arr <span class="token operator">=</span> <span class="token punctuation">[</span>Color_str<span class="token punctuation">(</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">'GREEN'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Color_str<span class="token punctuation">(</span><span class="token string">'N'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>set_color<span class="token punctuation">(</span><span class="token string">&quot;RED&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
</code></pre></div><p><code>print(arr[0], arr[1])</code>是msg本体正常颜色的Y和N<br> <code>print(arr)</code>打印出来的是绿色的Y和红色的N：[<span style="color:green;">Y</span>, <span style="color:red;">N</span>]</p> <h2 id="索引相关"><a href="#索引相关" class="header-anchor">#</a> 索引相关</h2> <ul><li><code>__getitem__</code></li> <li><code>__setitem__</code></li> <li><code>__delitem__</code></li></ul> <p>在读取、修改、删除对象成员按索引<code>[0]</code>的时候可以分别定义以上方法。<br>
事实上内置模块<a href="https://docs.python.org/zh-cn/3/library/operator.html" target="_blank" rel="noopener noreferrer"><code>operator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>里就包括这些同名的方法映射了索引的操作。<br>
而在需要切片<code>[0:1]</code>时则可以用这些方法结合内置函数<code>slice(start, stop, step)</code>来自定义。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name<span class="token operator">=</span>name

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">=</span>value
    <span class="token keyword">def</span> <span class="token function">__delitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'del obj[key]时,我执行'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">__delattr__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'del obj.key时,我执行'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

f1<span class="token operator">=</span>Foo<span class="token punctuation">(</span><span class="token string">'sb'</span><span class="token punctuation">)</span>
f1<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">18</span>
f1<span class="token punctuation">[</span><span class="token string">'age1'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">19</span>
<span class="token keyword">del</span> f1<span class="token punctuation">.</span>age1
<span class="token keyword">del</span> f1<span class="token punctuation">[</span><span class="token string">'age'</span><span class="token punctuation">]</span>
f1<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'alex'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f1<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>
</code></pre></div><p>如果一个类没实现<code>__iter__</code>只实现了<code>__getitem__</code> , 也是可以被<code>iter()</code>执行创建初始化的迭代器的。</p> <p>除此之外还有<code>__missing__</code>，<br>
通过 <code>dict[key]</code>或者 <code>dict.__getitem__(key)</code> 访问不存在的key时就会返回<code>__missing__()</code><br>
当然，<code>dict</code>类并没有实现它，但是<code>collections.defaultdict</code>类实现了它</p> <h2 id="实例化相关"><a href="#实例化相关" class="header-anchor">#</a> 实例化相关</h2> <p>除了<code>__init__</code>还有一个<code>__new__</code>（构造函数）。<br>
实例化时触发，重写时必须返回<code>super().__new__(cls)</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#python单例模式</span>
<span class="token keyword">class</span> <span class="token class-name">Singleton</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token string">'_instance'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            cls<span class="token punctuation">.</span>_instance <span class="token operator">=</span> <span class="token builtin">object</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>_instance
one <span class="token operator">=</span> Singleton<span class="token punctuation">(</span><span class="token punctuation">)</span>
two <span class="token operator">=</span> Singleton<span class="token punctuation">(</span><span class="token punctuation">)</span>

two<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>one<span class="token punctuation">.</span>a<span class="token punctuation">)</span>
<span class="token comment"># 3</span>
<span class="token comment"># one和two完全相同,可以用id(), ==, is检测</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>one<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 29097904</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>two<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 29097904</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>one <span class="token operator">==</span> two<span class="token punctuation">)</span>
<span class="token comment"># True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>one <span class="token keyword">is</span> two<span class="token punctuation">)</span>
</code></pre></div><h2 id="调用相关"><a href="#调用相关" class="header-anchor">#</a> 调用相关</h2> <p><code>__call__</code><br>
对象后面加括号，触发执行<code>__call__</code>。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'__call__'</span><span class="token punctuation">)</span>

obj <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 执行 __init__和__new__</span>
obj<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># 执行 __call__</span>
</code></pre></div><p>内置函数<code>callable</code>也会辨别它。</p> <h2 id="对象属性相关"><a href="#对象属性相关" class="header-anchor">#</a> 对象属性相关</h2> <p>在访问对象的属性的时候 依照这样一个优先级 经过③轮遍历：</p> <ol><li>①继承树中各个类的<code>__getattribute__</code>方法</li> <li>本类的数据描述符属性</li> <li>本实例属性（<code>obj.__dict__</code>）</li> <li>本类的非数据描述符属性</li> <li>②继承树各个类的属性和描述符属性（<code>super().__dict__</code>）</li> <li>③继承树各个类的<code>__getattr__</code>方法</li> <li>抛出<code>AttributeError</code>异常</li></ol> <h3 id="getattr"><a href="#getattr" class="header-anchor">#</a> <code>__getattr__</code></h3> <p>如果找不到对象的属性时会调用这个方法<br>
这个方法应该返回属性值或者抛出<code>AttributeError</code>异常<br>
注意，如果通过以上优先级机制能找到对象属性的话，不会调用<code>__getattr__</code>方法<br>
另外两个</p> <ul><li><code>__setattr__</code>设置对象的属性</li> <li><code>__delattr__</code>删除对象的属性</li></ul> <h3 id="getattribute"><a href="#getattribute" class="header-anchor">#</a> <code>__getattribute__</code></h3> <p>当访问某个对象的属性时，会无条件的调用这个方法。这个方法只适用于新式类。<br>
该方法应该返回属性值或者抛出<code>AttributeError</code>异常。<br>
当同时定义<code>__getattribute__</code>和<code>__getattr__</code>时，<br> <code>__getattr__</code>方法不会再被调用，除非引发<code>AttributeError</code>异常</p> <div class="custom-block danger"><p class="custom-block-title">注意：</p> <p>当在<code>__getattribute__</code>代码块中，再次执行属性的获取操作时，<br>
会再次触发<code>__getattribute__</code>方法的调用，代码将会陷入无限递归</p></div> <h2 id="运算符相关"><a href="#运算符相关" class="header-anchor">#</a> 运算符相关</h2> <p>内置模块<a href="https://docs.python.org/zh-cn/3/library/operator.html" target="_blank" rel="noopener noreferrer"><code>operator</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>里的函数与运算符映射。重写以下方法其实是影响的operator中函数的调用。</p> <h3 id="逻辑运算"><a href="#逻辑运算" class="header-anchor">#</a> 逻辑运算</h3> <p>布尔类型转换（如直接<code>if</code>）调用<code>__bool__</code>，需要返回布尔值</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">def</span> <span class="token function">__bool__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">bool</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>a<span class="token punctuation">)</span>
a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> a<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>!<span class="token builtin">bool</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>如果不定义<code>__bool__</code>， 会默认以<code>bool(__len__())</code>为结果，如果未定义<code>__len__</code> 始终为True</p> <h3 id="比较运算"><a href="#比较运算" class="header-anchor">#</a> 比较运算</h3> <p><code>__eq__</code></p> <p>遇到比较运算符时触发，需要返回布尔值</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>a <span class="token operator">==</span> obj<span class="token punctuation">.</span>a <span class="token keyword">and</span> self<span class="token punctuation">.</span>b <span class="token operator">==</span> obj<span class="token punctuation">.</span>b<span class="token punctuation">)</span>
a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span>
</code></pre></div><p>如果一个类重写了<code>__eq__</code>方法，它的<code>__hash__</code>就会变成None而继承不到。</p> <p>其他运算操作符与之相似：<code>__lt__()</code>、<code>__le__()</code>、<code>__ne__()</code>、<code>__gt__()</code>和<code>__ge__()</code>等</p> <h2 id="其他内置函数有关"><a href="#其他内置函数有关" class="header-anchor">#</a> 其他内置函数有关</h2> <p>内置函数<code>len()</code>调用<code>__len__</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>
a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>内置函数<code>hash()</code>调用<code>__hash__</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span>
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">def</span> <span class="token function">__hash__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">hash</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hash</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/markdown-note/py/17-封装和继承.html" class="prev">
        封装和继承
      </a></span> <span class="next"><a href="/markdown-note/py/19-多态和泛型.html">
        多态和泛型
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/markdown-note/assets/js/app.6b4725cf.js" defer></script><script src="/markdown-note/assets/js/8.ae913670.js" defer></script><script src="/markdown-note/assets/js/1.5bc6bece.js" defer></script><script src="/markdown-note/assets/js/59.d67ff772.js" defer></script>
  </body>
</html>
