<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>闭包和装饰器 | nanarino note</title>
    <meta name="description" content="super best match, are you ready">
    <link rel="shortcut icon" href="./favicon.ico">
    
    <link rel="preload" href="/markdown-note/assets/css/0.styles.5b09f17c.css" as="style"><link rel="preload" href="/markdown-note/assets/js/app.cb29c754.js" as="script"><link rel="preload" href="/markdown-note/assets/js/6.76f2ff63.js" as="script"><link rel="preload" href="/markdown-note/assets/js/1.9b09ebd9.js" as="script"><link rel="preload" href="/markdown-note/assets/js/53.c918a9c8.js" as="script"><link rel="prefetch" href="/markdown-note/assets/js/10.e8c8b5cf.js"><link rel="prefetch" href="/markdown-note/assets/js/11.adda566b.js"><link rel="prefetch" href="/markdown-note/assets/js/12.82cf2b7c.js"><link rel="prefetch" href="/markdown-note/assets/js/13.1c7b5fd5.js"><link rel="prefetch" href="/markdown-note/assets/js/14.24a00c25.js"><link rel="prefetch" href="/markdown-note/assets/js/15.871e5249.js"><link rel="prefetch" href="/markdown-note/assets/js/16.3ae861c3.js"><link rel="prefetch" href="/markdown-note/assets/js/17.7001d472.js"><link rel="prefetch" href="/markdown-note/assets/js/18.c11d090b.js"><link rel="prefetch" href="/markdown-note/assets/js/19.1c8db138.js"><link rel="prefetch" href="/markdown-note/assets/js/20.3d633e03.js"><link rel="prefetch" href="/markdown-note/assets/js/21.959c3542.js"><link rel="prefetch" href="/markdown-note/assets/js/22.2921ffce.js"><link rel="prefetch" href="/markdown-note/assets/js/23.ca0ca5d6.js"><link rel="prefetch" href="/markdown-note/assets/js/24.6ec28565.js"><link rel="prefetch" href="/markdown-note/assets/js/25.858dd617.js"><link rel="prefetch" href="/markdown-note/assets/js/26.24a21ad6.js"><link rel="prefetch" href="/markdown-note/assets/js/27.5aa02188.js"><link rel="prefetch" href="/markdown-note/assets/js/28.ff556a23.js"><link rel="prefetch" href="/markdown-note/assets/js/29.14547d7b.js"><link rel="prefetch" href="/markdown-note/assets/js/3.759687af.js"><link rel="prefetch" href="/markdown-note/assets/js/30.bfd1d077.js"><link rel="prefetch" href="/markdown-note/assets/js/31.758f6d71.js"><link rel="prefetch" href="/markdown-note/assets/js/32.53f12d83.js"><link rel="prefetch" href="/markdown-note/assets/js/33.99f32186.js"><link rel="prefetch" href="/markdown-note/assets/js/34.ebe69c88.js"><link rel="prefetch" href="/markdown-note/assets/js/35.8e3c8863.js"><link rel="prefetch" href="/markdown-note/assets/js/36.1d251543.js"><link rel="prefetch" href="/markdown-note/assets/js/37.137875a7.js"><link rel="prefetch" href="/markdown-note/assets/js/38.70eb7d28.js"><link rel="prefetch" href="/markdown-note/assets/js/39.f116ba49.js"><link rel="prefetch" href="/markdown-note/assets/js/4.049feed2.js"><link rel="prefetch" href="/markdown-note/assets/js/40.fab3d75a.js"><link rel="prefetch" href="/markdown-note/assets/js/41.806fbbbb.js"><link rel="prefetch" href="/markdown-note/assets/js/42.ab830b2d.js"><link rel="prefetch" href="/markdown-note/assets/js/43.b2eff0be.js"><link rel="prefetch" href="/markdown-note/assets/js/44.55def96f.js"><link rel="prefetch" href="/markdown-note/assets/js/45.3a3fffc1.js"><link rel="prefetch" href="/markdown-note/assets/js/46.c4ae8f58.js"><link rel="prefetch" href="/markdown-note/assets/js/47.a6283ee6.js"><link rel="prefetch" href="/markdown-note/assets/js/48.dfc01987.js"><link rel="prefetch" href="/markdown-note/assets/js/49.53ff3a1a.js"><link rel="prefetch" href="/markdown-note/assets/js/5.eccc2251.js"><link rel="prefetch" href="/markdown-note/assets/js/50.43308e27.js"><link rel="prefetch" href="/markdown-note/assets/js/51.404a37fb.js"><link rel="prefetch" href="/markdown-note/assets/js/52.ff68a6cd.js"><link rel="prefetch" href="/markdown-note/assets/js/54.bd220d15.js"><link rel="prefetch" href="/markdown-note/assets/js/55.ee1b64bc.js"><link rel="prefetch" href="/markdown-note/assets/js/56.dcd55c50.js"><link rel="prefetch" href="/markdown-note/assets/js/57.e99f45fd.js"><link rel="prefetch" href="/markdown-note/assets/js/58.626e12aa.js"><link rel="prefetch" href="/markdown-note/assets/js/59.1cb005c3.js"><link rel="prefetch" href="/markdown-note/assets/js/60.6902e45b.js"><link rel="prefetch" href="/markdown-note/assets/js/61.fc05d045.js"><link rel="prefetch" href="/markdown-note/assets/js/62.6a25f866.js"><link rel="prefetch" href="/markdown-note/assets/js/63.1d1dd17d.js"><link rel="prefetch" href="/markdown-note/assets/js/64.2dcbfd9e.js"><link rel="prefetch" href="/markdown-note/assets/js/65.5c9c87c3.js"><link rel="prefetch" href="/markdown-note/assets/js/66.1c5b97fa.js"><link rel="prefetch" href="/markdown-note/assets/js/67.1cbe395a.js"><link rel="prefetch" href="/markdown-note/assets/js/68.332efaa5.js"><link rel="prefetch" href="/markdown-note/assets/js/69.fa0ec371.js"><link rel="prefetch" href="/markdown-note/assets/js/7.a40a9251.js"><link rel="prefetch" href="/markdown-note/assets/js/70.8811effb.js"><link rel="prefetch" href="/markdown-note/assets/js/71.299da003.js"><link rel="prefetch" href="/markdown-note/assets/js/72.57e16e2c.js"><link rel="prefetch" href="/markdown-note/assets/js/73.ec33b2e7.js"><link rel="prefetch" href="/markdown-note/assets/js/74.1c91de5f.js"><link rel="prefetch" href="/markdown-note/assets/js/75.1283c694.js"><link rel="prefetch" href="/markdown-note/assets/js/76.5330e930.js"><link rel="prefetch" href="/markdown-note/assets/js/77.dd8bb362.js"><link rel="prefetch" href="/markdown-note/assets/js/78.d9cb7856.js"><link rel="prefetch" href="/markdown-note/assets/js/79.e9104c6e.js"><link rel="prefetch" href="/markdown-note/assets/js/8.9d80db57.js"><link rel="prefetch" href="/markdown-note/assets/js/80.fdcefd78.js"><link rel="prefetch" href="/markdown-note/assets/js/81.cc4c70f2.js"><link rel="prefetch" href="/markdown-note/assets/js/9.455cb5eb.js">
    <link rel="stylesheet" href="/markdown-note/assets/css/0.styles.5b09f17c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown-note/" class="home-link router-link-active"><!----> <span class="site-name">nanarino note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link router-link-active">Python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="about" class="dropdown-title"><span class="title">about</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/kogawananari" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link router-link-active">Python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="about" class="dropdown-title"><span class="title">about</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/kogawananari" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>起步</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>函数</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/markdown-note/py/10-文件处理.html" class="sidebar-link">文件处理</a></li><li><a href="/markdown-note/py/11-日志处理.html" class="sidebar-link">日志处理</a></li><li><a href="/markdown-note/py/12-函数和作用域.html" class="sidebar-link">函数和作用域</a></li><li><a href="/markdown-note/py/13-闭包和装饰器.html" class="active sidebar-link">闭包和装饰器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown-note/py/13-闭包和装饰器.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/13-闭包和装饰器.html#开放封闭原则" class="sidebar-link">开放封闭原则</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/13-闭包和装饰器.html#装饰器" class="sidebar-link">装饰器</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/13-闭包和装饰器.html#偏函数" class="sidebar-link">偏函数</a></li></ul></li><li><a href="/markdown-note/py/14-递归和深拷贝.html" class="sidebar-link">递归和深拷贝</a></li><li><a href="/markdown-note/py/15-迭代器和生成器.html" class="sidebar-link">迭代器和生成器</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面向对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>WEB相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂项模块</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="闭包和装饰器"><a href="#闭包和装饰器" class="header-anchor">#</a> 闭包和装饰器</h1> <p>闭包是函数作用域的体现<br>
装饰器本质就是函数,功能是为其他函数添加附加功能</p> <h2 id="闭包"><a href="#闭包" class="header-anchor">#</a> 闭包</h2> <blockquote><p>闭包（Closure）是词法闭包（Lexical Closure）的简称，是引用了自由变量的函数。这个被引用的自由变量将和这个函数一同存在，即使已经离开了创造它的环境也不例外。所以，闭包是由函数和与其相关的引用环境组合而成的实体。</p> <p>闭包的原理，当内嵌函数引用了包含它的函数（enclosing function）中的non-local 变量后，这些变量会被保存在enclosing function的<code>__closure__</code>属性中，成为enclosing function本身的一部分；也就是说，这些变量的生命周期会和enclosing function一样。</p> <p>在Python中创建一个闭包可以归结为以下三点：</p> <ul><li>闭包函数必须有内嵌函数</li> <li>内嵌函数需要引用该嵌套函数上一级namespace中的变量</li> <li>闭包函数必须返回内嵌函数</li></ul></blockquote> <h3 id="闭包示例"><a href="#闭包示例" class="header-anchor">#</a> 闭包示例</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    step <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">add1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">nonlocal</span> step
        step <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>step<span class="token punctuation">)</span>
    <span class="token keyword">return</span> add1
<span class="token comment">#foo函数执行会返回一个累加作用的函数add1 </span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> foo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token comment">#函数执行结束作用域立即销毁 得利于python解释器的自动回收垃圾的机制</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token operator">=</span>foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token operator">=</span>foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> a<span class="token punctuation">.</span>__closure__<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> a<span class="token punctuation">.</span>__closure__<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token number">2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> a<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> a<span class="token punctuation">.</span>__closure__<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token number">3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> b<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">2</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
<span class="token comment">#闭包让作用域不会被销毁 </span>
<span class="token comment">#__closure__属性拿到所引用的内部变量的内存地址（只做了解）</span>
</code></pre></div><p>由于内存得不到自动释放，这里的foo执行会生成<strong>互不影响</strong>的累加器。<br>
这与之后章节的生成器具有相同的功能。</p> <h2 id="开放封闭原则"><a href="#开放封闭原则" class="header-anchor">#</a> 开放封闭原则</h2> <blockquote><p>不修改被修饰函数的源代码
不修改被修改函数的调用方式</p></blockquote> <h2 id="装饰器"><a href="#装饰器" class="header-anchor">#</a> 装饰器</h2> <p>在python中，装饰器（<code>Decorator</code>）就是一个返回函数的高阶函数，修改了目标函数的功能且符合开放封闭原则</p> <h3 id="装饰器的实现"><a href="#装饰器的实现" class="header-anchor">#</a> 装饰器的实现</h3> <p>利用: <u>高阶函数</u>  和  <u>闭包</u></p> <ul><li>装饰器名foo</li> <li>被修饰的函数名bar</li></ul> <p>bar声明的前一行<code>@foo</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        code
        ret <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        code
        <span class="token keyword">return</span> ret
    <span class="token keyword">return</span> wrapper
    
<span class="token decorator annotation punctuation">@foo</span>
<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre></div><p>相当于<code>bar = foo(bar)</code>，这样，在不改变<code>bar</code>调用方式的情况下增加了<code>bar</code>的功能<br>
但是 ,<code>bar</code>的函数名却被修改为了<code>'wrapper'</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> bar<span class="token punctuation">.</span>__name__
<span class="token string">'wrapper'</span>
</code></pre></div><p>使用装饰器<code>functools.wraps</code>修改马甲，完整版如下</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> functools

<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        code
        ret <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        code
        <span class="token keyword">return</span> ret
    <span class="token keyword">return</span> wrapper
    
<span class="token decorator annotation punctuation">@foo</span>
<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre></div><p>更复杂的装饰器也只是在这个基础上套娃。</p> <h2 id="偏函数"><a href="#偏函数" class="header-anchor">#</a> 偏函数</h2> <p>不同于数学意义，偏函数（Partial function），可以把函数分两次调用，每次传一部分参数的函数。</p> <div class="language- extra-class"><pre class="language-text"><code>def foo(x, y):
    return x + y
</code></pre></div><p>高阶函数<code>functools.partial</code>可以帮助我们创建一个偏函数</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">import</span> functools
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> bar <span class="token operator">=</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span>foo<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token operator">-</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> bar<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">50</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> bar<span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token number">0</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/markdown-note/py/12-函数和作用域.html" class="prev">函数和作用域</a></span> <span class="next"><a href="/markdown-note/py/14-递归和深拷贝.html">递归和深拷贝</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/markdown-note/assets/js/app.cb29c754.js" defer></script><script src="/markdown-note/assets/js/6.76f2ff63.js" defer></script><script src="/markdown-note/assets/js/1.9b09ebd9.js" defer></script><script src="/markdown-note/assets/js/53.c918a9c8.js" defer></script>
  </body>
</html>
