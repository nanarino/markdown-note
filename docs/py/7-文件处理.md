# 文件处理

##  基本操作:

1. ​    打开文件,得到文件句柄并赋值给变量
2. ​    通过句柄对文件进行操作
3. ​    关闭文件  

```python
    f=open("文件名",encoding='utf-8')#默认系统编码win下GBK
    data=f.read()
    print(data)
    f.close()
```

## open()

#### 模式:

只读"r"(默认)

只写"w" 如果文件存在则清空 不存在则新建

可读可写"r+"

追加写入"a"/"a+"  如`f=open("x.txt","a")`

```python
f.read() #连续读字符 默认全部读完
f.readable() #是否可读
f.readline() #连续读行
f.readlines()#用列表返回每一行

f.write(str) #连续写 "a"模式在末尾追加
f.writeable() #是否可写
f.writelines(list) #传入列表如["aaa\n","bbb\n","ccc\n"]
```



##### with open() as f

不需要关闭
相当于`f=open()`
           `f.close()`
    

## b模式:

不能设置encoding
    "rb" 读二进制

```python
    data=f.read()
    print(data.decode("utf-8"))
```


​    "wb" 写二进制

```python
    f.write(bytes("内容",encoding="utf-8"))
```

​    "ab"追加



open参数`encoding="latin-1"`



open参数`newline=""`适应操作系统的效果
				\n回车  =>  win下\r\n回车



```python
f.flush() #刷新
f.tell()  #当前光标所在位置
f.seek(int,int默认0)  #相对位置读字节
"""
    负数倒着读,只能b模式下使用
    第二个参数:
        0代表从文件开头开始算起
        1代表从当前位置开始算起
        2代表从文件末尾算起。
    utf的3字节一个汉字 seek(3)相当于从头开始read(1)
"""
f.truncate(int)#截取字节
```



#### 循环文件的推荐方式

如:

```python
for i in f:
    offs=-10
    while 1:
        f.seek(offs,2)
        data=f.readlines()
        if len(data)>1:
            print("最后一行是"+data[-1].decode("utf-8"))
            break
        offs*=2
```

不推荐:

```python
for i in f.readlines(): ...
```

​    

#### 又到了例题环节

现在有一个recensement.txt文件

```txt
1 	Paris 	2229621
2 	Marseille 	855393
3 	Lyon 	500715
4 	Toulouse 	458298
5 	Nice 	342295
6 	Nantes 	292718
.......
70 	Drancy 	68241
71 	Colmar 	67956
72 	Ajaccio 	67507
73 	Bourges 	67189
74 	Issy-les-Moulineaux 	65662
75 	Levallois-Perret 	65264
```

将它转化为一个字典再求出所有数的和

```python
import json    #引入json模块只是为了好看,后面会讲
import functools    #高阶函数functools.reduce以后会讲
with open ('recensement.txt','r',encoding='utf-8') as f:
    dic = {}
    for line in f:
        k=line.strip().split("\t")[1]
        val=line.strip().split("\t")[-1]
        dic[k]=val
    print(json.dumps(dic,sort_keys=True,indent=2,separators=(',',':'),ensure_ascii=False))
    co=functools.reduce(lambda r,x:int(r)+int(x),list(dic.values()))
    print("总和是%s"%co)
```

执行结果

```python
{
  "Aix-en-Provence ":"141545",
  "Ajaccio ":"67507",
  "Amiens ":"132699",
  "Angers ":"150125",
  "Antibes ":"75456",
  "Argenteuil ":"106817",
#......
  "Toulouse ":"458298",
  "Tourcoing ":"93974",
  "Tours ":"134803",
  "Versailles ":"85272",
  "Villeurbanne ":"147192",
  "Vitry-sur-Seine ":"90075"
}
总和是12470089
```

