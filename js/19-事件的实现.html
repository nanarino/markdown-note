<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>事件的实现 | nanarino note</title>
    <meta name="description" content="a note I took with markdown">
    
    
    <link rel="preload" href="/markdown-note/assets/css/0.styles.447f505d.css" as="style"><link rel="preload" href="/markdown-note/assets/js/app.9fff5c40.js" as="script"><link rel="preload" href="/markdown-note/assets/js/20.f0242daa.js" as="script"><link rel="prefetch" href="/markdown-note/assets/js/10.8e85cf15.js"><link rel="prefetch" href="/markdown-note/assets/js/11.befe4248.js"><link rel="prefetch" href="/markdown-note/assets/js/12.f7cd383b.js"><link rel="prefetch" href="/markdown-note/assets/js/13.38cbb14c.js"><link rel="prefetch" href="/markdown-note/assets/js/14.26e3e81e.js"><link rel="prefetch" href="/markdown-note/assets/js/15.f1b6bea3.js"><link rel="prefetch" href="/markdown-note/assets/js/16.f091bb8c.js"><link rel="prefetch" href="/markdown-note/assets/js/17.7a22d023.js"><link rel="prefetch" href="/markdown-note/assets/js/18.59b1f62a.js"><link rel="prefetch" href="/markdown-note/assets/js/19.cb7d8146.js"><link rel="prefetch" href="/markdown-note/assets/js/2.11da7a94.js"><link rel="prefetch" href="/markdown-note/assets/js/21.fa3ba5da.js"><link rel="prefetch" href="/markdown-note/assets/js/22.283e00bb.js"><link rel="prefetch" href="/markdown-note/assets/js/23.b7f0dbb3.js"><link rel="prefetch" href="/markdown-note/assets/js/24.b86f4a34.js"><link rel="prefetch" href="/markdown-note/assets/js/25.d47e5e80.js"><link rel="prefetch" href="/markdown-note/assets/js/26.6343ad88.js"><link rel="prefetch" href="/markdown-note/assets/js/27.f80a9d63.js"><link rel="prefetch" href="/markdown-note/assets/js/28.e362d19f.js"><link rel="prefetch" href="/markdown-note/assets/js/29.c5218ff0.js"><link rel="prefetch" href="/markdown-note/assets/js/3.249571e8.js"><link rel="prefetch" href="/markdown-note/assets/js/30.a3490c46.js"><link rel="prefetch" href="/markdown-note/assets/js/31.2979d13e.js"><link rel="prefetch" href="/markdown-note/assets/js/32.82662b5c.js"><link rel="prefetch" href="/markdown-note/assets/js/33.4a70e37b.js"><link rel="prefetch" href="/markdown-note/assets/js/34.a3c4dafe.js"><link rel="prefetch" href="/markdown-note/assets/js/35.7d587dfb.js"><link rel="prefetch" href="/markdown-note/assets/js/36.9ec3bd61.js"><link rel="prefetch" href="/markdown-note/assets/js/37.103149b3.js"><link rel="prefetch" href="/markdown-note/assets/js/38.d6389bc9.js"><link rel="prefetch" href="/markdown-note/assets/js/39.b9ab678c.js"><link rel="prefetch" href="/markdown-note/assets/js/4.ac9f756f.js"><link rel="prefetch" href="/markdown-note/assets/js/40.de345d62.js"><link rel="prefetch" href="/markdown-note/assets/js/41.6499a4c4.js"><link rel="prefetch" href="/markdown-note/assets/js/42.e11ba283.js"><link rel="prefetch" href="/markdown-note/assets/js/43.81c4f6aa.js"><link rel="prefetch" href="/markdown-note/assets/js/44.598b051d.js"><link rel="prefetch" href="/markdown-note/assets/js/45.42f48a17.js"><link rel="prefetch" href="/markdown-note/assets/js/46.a4162e31.js"><link rel="prefetch" href="/markdown-note/assets/js/47.c321268b.js"><link rel="prefetch" href="/markdown-note/assets/js/48.96d0bf0d.js"><link rel="prefetch" href="/markdown-note/assets/js/49.8de7548c.js"><link rel="prefetch" href="/markdown-note/assets/js/5.8faa297c.js"><link rel="prefetch" href="/markdown-note/assets/js/50.01ff550c.js"><link rel="prefetch" href="/markdown-note/assets/js/51.7e319c9b.js"><link rel="prefetch" href="/markdown-note/assets/js/52.df096cdd.js"><link rel="prefetch" href="/markdown-note/assets/js/53.9396bb72.js"><link rel="prefetch" href="/markdown-note/assets/js/54.409865cc.js"><link rel="prefetch" href="/markdown-note/assets/js/55.32589aeb.js"><link rel="prefetch" href="/markdown-note/assets/js/56.4efbb75f.js"><link rel="prefetch" href="/markdown-note/assets/js/57.c47847a9.js"><link rel="prefetch" href="/markdown-note/assets/js/58.b8f2f9cb.js"><link rel="prefetch" href="/markdown-note/assets/js/59.dec67bd6.js"><link rel="prefetch" href="/markdown-note/assets/js/6.3fa7f94b.js"><link rel="prefetch" href="/markdown-note/assets/js/60.728ce7a4.js"><link rel="prefetch" href="/markdown-note/assets/js/7.9218be4d.js"><link rel="prefetch" href="/markdown-note/assets/js/8.3269e16e.js"><link rel="prefetch" href="/markdown-note/assets/js/9.1b085dce.js">
    <link rel="stylesheet" href="/markdown-note/assets/css/0.styles.447f505d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown-note/" class="home-link router-link-active"><!----> <span class="site-name">nanarino note</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link">Python</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Other</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino/markdown-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.akokono.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mysite
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link">Python</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Other</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino/markdown-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.akokono.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mysite
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>起步</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>函数和作用域</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据类型和对象</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>BOM和DOM对象</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/markdown-note/js/18-DOM方法.html" class="sidebar-link">DOM方法</a></li><li><a href="/markdown-note/js/19-事件的实现.html" class="active sidebar-link">事件的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown-note/js/19-事件的实现.html#事件绑定" class="sidebar-link">事件绑定</a></li><li class="sidebar-sub-header"><a href="/markdown-note/js/19-事件的实现.html#事件监听" class="sidebar-link">事件监听</a></li><li class="sidebar-sub-header"><a href="/markdown-note/js/19-事件的实现.html#事件委托" class="sidebar-link">事件委托</a></li></ul></li><li><a href="/markdown-note/js/20-事件对象.html" class="sidebar-link">事件对象</a></li><li><a href="/markdown-note/js/21-BOM相关.html" class="sidebar-link">BOM相关</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>补充知识点</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="事件的实现"><a href="#事件的实现" aria-hidden="true" class="header-anchor">#</a> 事件的实现</h1> <p>&quot;IE8是最后一个还在使用自己的事件系统的浏览器。&quot;</p> <h2 id="事件绑定"><a href="#事件绑定" aria-hidden="true" class="header-anchor">#</a> 事件绑定</h2> <p>​	在浏览器发生的事情统称为事件, 比如点击事件, 鼠标移动事件, 键盘事件, 点击事件, 请求事件,加载完成事件. 面对突发事件, 我们都需要进行处理. <strong>用函数处理.</strong></p> <p>​	函数可以处理事件但是函数摸不着事件的头脑.于是,浏览器出面帮助函数处理事件,浏览器整理了一下事件触发的一状态,整理成了一个<strong>事件对象.</strong> <strong>事件对象存储了事件触发的各种状态</strong> 包括事件触发的主体对象,事件类型,事件触发的位置等等.形参的名字通常是e或者event.</p> <p>​	e里面有一个type属性,是一个字符串, 是当前事件的名字.</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token comment">//&quot;click&quot;</span>
</code></pre></div><p>绑定点击事件可以用(对象.on+事件名) 的方式绑定事件, 然后挂载上处理函数接受事件对象来进行处理.这就是传说中的<strong>事件绑定</strong> .</p> <p>事件绑定的特点:</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//点击文档 打印1</span>
document<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//点击文档 打印2</span>
</code></pre></div><ol><li>事件绑定同一个对象只能给同一个事件绑定唯一一个事件处理函数.如果绑定第二个,第一个会被清除掉.因为本质上只是给对象的on事件属性上添加了一个函数.</li> <li>事件绑定函数得this指向当前调用(触发)事件的主体对象</li> <li>在绑定事件之前, 事件属性的处理函数默认是null</li> <li>清除事件的方式只需要讲此事件的触发函数改成null</li></ol> <p>我们称on这种方式绑定的事件是<strong>DOM0级事件</strong></p> <p>优点: 兼容所有的浏览器，因为它是最原始的事件，js出来的那一天事件都是这么绑定的。</p> <p>缺点: 这种绑定事件的方法，一个对象只能绑定一个事件，不能绑定多个事件。</p> <h2 id="事件监听"><a href="#事件监听" aria-hidden="true" class="header-anchor">#</a> 事件监听</h2> <p>当事件触发的时候, 我们不直接写明处理的函数来响应事件.咱们叫一个播报员去某个元素那守着,如果触发了某个事件,那就回来通知我,然后我指派函数执行.这种行为类似监听. 我们管他叫事件监听. 事件监听在节点对象的原型上</p> <div class="language-js extra-class"><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>事件对象处理也是使用函数处理, 并且这里生成的事件对象和事件绑定生成的对象是同一个</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>window<span class="token punctuation">.</span>_a <span class="token operator">=</span> e<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>window<span class="token punctuation">.</span>_b <span class="token operator">=</span> e<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//点击触发一次事件</span>
_a <span class="token operator">===</span> _b <span class="token comment">//true</span>
</code></pre></div><ol><li>事件监听接受两个参数( <strong>三个</strong> ) 第一个是需要监听的事件类型, 第二个是事件的触发的回调函数, 第三个是是否事件冒泡.</li> <li>事件类型不需要加on+事件类型,直接事件类型即可.</li> <li>一次可以绑定多个事件, 相互之间不影响.并且触发顺序就是绑定顺序</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//点击 打印1 2</span>
</code></pre></div><ol start="4"><li>事件监听处理函数得this指向当前调用(触发)事件的主体对象</li> <li>取消事件监听用对应的方式,removeEventListener,传入的参数要和添加的参数<strong>完全一致</strong></li></ol> <p>我们称这种事件的监听方式是<strong>DOM2级事件</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span>
li<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
<span class="token comment">// 点击li 触发</span>
li<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handle<span class="token punctuation">)</span>
<span class="token comment">// 点击就没有反应了</span>
</code></pre></div><p>特殊的: 匿名事件处理函数是没法取消绑定事件的</p> <div class="language-js extra-class"><pre class="language-js"><code>li<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 点击触发</span>
li<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 关闭不了 因为此function不是彼function</span>
</code></pre></div><p>其中addEventListener不兼容低版本的IE浏览器</p> <p>在低版本的IE浏览器中使用: attachEvent和detachEvent</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//不需要传入事件对象</span>
    <span class="token keyword">var</span> e <span class="token operator">=</span> window<span class="token punctuation">.</span>event
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">===</span>li<span class="token punctuation">)</span> <span class="token comment">//true</span>
<span class="token punctuation">}</span>
li<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">&quot;onclick&quot;</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
<span class="token comment">//添加</span>
li<span class="token punctuation">.</span><span class="token function">detachEvent</span><span class="token punctuation">(</span><span class="token string">&quot;onclick&quot;</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
<span class="token comment">//删除</span>
</code></pre></div><p>这里就有针对不同浏览器的兼容性封装,我们可以封装一个事件添加和删除的公共方法.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> EventUtil <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">addHandle</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span><span class="token punctuation">{</span>
            el<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//attachEvent</span>
            el<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">&quot;on&quot;</span><span class="token operator">+</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment">// </span>
            el<span class="token punctuation">[</span><span class="token string">&quot;on&quot;</span><span class="token operator">+</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> handler
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">removeHandle</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>removeEventListener<span class="token punctuation">)</span><span class="token punctuation">{</span>
            el<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>deleteEvent<span class="token punctuation">)</span><span class="token punctuation">{</span>
            el<span class="token punctuation">.</span><span class="token function">detachEvent</span><span class="token punctuation">(</span><span class="token string">&quot;on&quot;</span><span class="token operator">+</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            el<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token string">&quot;on&quot;</span><span class="token operator">+</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//针对event的兼容</span>
</code></pre></div><h2 id="事件委托"><a href="#事件委托" aria-hidden="true" class="header-anchor">#</a> 事件委托</h2> <p>当我们需要绑定事件的时候, 需要给事件添加绑定或者监听. 当事件触发的时候,我们会对事件的主体进行操作. 但是如果有大量dom对象需要绑定事件,并且事件的处理函数是同一个的时候. 这种绑定方式或者监听方式就是很蠢. 并且修改起来也会很麻烦。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> ali <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//handle it</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>l <span class="token operator">=</span> ali<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ali<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
    <span class="token comment">//ali[i].onclick = fn</span>
<span class="token punctuation">}</span>
<span class="token comment">//修改的话需要再循环一次删除和添加</span>
</code></pre></div><p>这里addEventListener是个添加监听的函数，内部有添加事件的操作。并且有很多重复。所以从性能的角度上讲addEventListener循环绑定或者监听不可取。</p> <p>于是我们就设计了另外一个监听方式，通过监听公共父元素的形式监听事件。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> list <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.list&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> ali <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.list&gt;li&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//handle it</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token comment">// 这是事件对象的触发主体对象</span>
<span class="token punctuation">}</span>
list<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
</code></pre></div><p>在事件处理函数fn中, 咱们可以通过事件对象来进行识别和判断触发事件的对象,从而达到事件处理的目的. 识别触发事件的对象是用e.target（当前触发函数的DOM对象）来控制的。</p> <p>比如：再一个DOM结构中有ul&gt;li*100这样的结构，我们对ul进行监听，比如点击事件。当我们点击ul下面的li的时候： 会触发ul的点击事件(因为li是在ul中，所以也会触发。事件冒泡后面讲)。然后对此事件的target与自己想要的内容判断</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>list<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
        <span class="token comment">//blabla</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//或者</span>
    <span class="token comment">//e.target.tagName.toLowerCase()===&quot;li&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样就能达到相同的效果，但是更优秀。因为这里只监听了一个事件，处理和控制也相对比较自由。添加和删除也没问题。。别人管他叫设计模式中的代理模式，或者事件委托。请大家将这种思想当成基本操作。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/markdown-note/assets/js/app.9fff5c40.js" defer></script><script src="/markdown-note/assets/js/20.f0242daa.js" defer></script>
  </body>
</html>
