<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>递归和深拷贝</title>
    <meta name="description" content="">
    <link rel="shortcut icon" href="./favicon.ico">
    
    <link rel="preload" href="/markdown-note/assets/css/0.styles.bbfe0b79.css" as="style"><link rel="preload" href="/markdown-note/assets/js/app.a730857b.js" as="script"><link rel="preload" href="/markdown-note/assets/js/6.4d707832.js" as="script"><link rel="preload" href="/markdown-note/assets/js/1.19267a43.js" as="script"><link rel="preload" href="/markdown-note/assets/js/54.7dafa28e.js" as="script"><link rel="prefetch" href="/markdown-note/assets/js/10.450906df.js"><link rel="prefetch" href="/markdown-note/assets/js/11.03a7ddb6.js"><link rel="prefetch" href="/markdown-note/assets/js/12.285e2227.js"><link rel="prefetch" href="/markdown-note/assets/js/13.97ba0a9a.js"><link rel="prefetch" href="/markdown-note/assets/js/14.ec3476fb.js"><link rel="prefetch" href="/markdown-note/assets/js/15.bbfd769a.js"><link rel="prefetch" href="/markdown-note/assets/js/16.579621fd.js"><link rel="prefetch" href="/markdown-note/assets/js/17.c9df6a57.js"><link rel="prefetch" href="/markdown-note/assets/js/18.5dfbe4e1.js"><link rel="prefetch" href="/markdown-note/assets/js/19.ebe955b7.js"><link rel="prefetch" href="/markdown-note/assets/js/20.defddc20.js"><link rel="prefetch" href="/markdown-note/assets/js/21.7d4d1fcf.js"><link rel="prefetch" href="/markdown-note/assets/js/22.2899262e.js"><link rel="prefetch" href="/markdown-note/assets/js/23.912e25d3.js"><link rel="prefetch" href="/markdown-note/assets/js/24.7c164a31.js"><link rel="prefetch" href="/markdown-note/assets/js/25.719e12c1.js"><link rel="prefetch" href="/markdown-note/assets/js/26.872fa261.js"><link rel="prefetch" href="/markdown-note/assets/js/27.f2e775cc.js"><link rel="prefetch" href="/markdown-note/assets/js/28.a459bb88.js"><link rel="prefetch" href="/markdown-note/assets/js/29.3a54dc76.js"><link rel="prefetch" href="/markdown-note/assets/js/3.ee307e01.js"><link rel="prefetch" href="/markdown-note/assets/js/30.dd3658bc.js"><link rel="prefetch" href="/markdown-note/assets/js/31.79702987.js"><link rel="prefetch" href="/markdown-note/assets/js/32.2e7dedd5.js"><link rel="prefetch" href="/markdown-note/assets/js/33.96b704bf.js"><link rel="prefetch" href="/markdown-note/assets/js/34.6a993818.js"><link rel="prefetch" href="/markdown-note/assets/js/35.20f1a93b.js"><link rel="prefetch" href="/markdown-note/assets/js/36.da9c6436.js"><link rel="prefetch" href="/markdown-note/assets/js/37.d549bbb2.js"><link rel="prefetch" href="/markdown-note/assets/js/38.32760f20.js"><link rel="prefetch" href="/markdown-note/assets/js/39.01a5e4c7.js"><link rel="prefetch" href="/markdown-note/assets/js/4.e5a448a1.js"><link rel="prefetch" href="/markdown-note/assets/js/40.3db3550a.js"><link rel="prefetch" href="/markdown-note/assets/js/41.eeab1495.js"><link rel="prefetch" href="/markdown-note/assets/js/42.cd0f2e3a.js"><link rel="prefetch" href="/markdown-note/assets/js/43.2dd76db4.js"><link rel="prefetch" href="/markdown-note/assets/js/44.c36f644e.js"><link rel="prefetch" href="/markdown-note/assets/js/45.d9ce19fc.js"><link rel="prefetch" href="/markdown-note/assets/js/46.70044768.js"><link rel="prefetch" href="/markdown-note/assets/js/47.8f8f07bc.js"><link rel="prefetch" href="/markdown-note/assets/js/48.a471ae00.js"><link rel="prefetch" href="/markdown-note/assets/js/49.399a9533.js"><link rel="prefetch" href="/markdown-note/assets/js/5.843fbad2.js"><link rel="prefetch" href="/markdown-note/assets/js/50.2cec459c.js"><link rel="prefetch" href="/markdown-note/assets/js/51.04ac969c.js"><link rel="prefetch" href="/markdown-note/assets/js/52.dd8e7b3c.js"><link rel="prefetch" href="/markdown-note/assets/js/53.5dcd3c45.js"><link rel="prefetch" href="/markdown-note/assets/js/55.39aee5f1.js"><link rel="prefetch" href="/markdown-note/assets/js/56.2bad3fa8.js"><link rel="prefetch" href="/markdown-note/assets/js/57.c0b9b3f7.js"><link rel="prefetch" href="/markdown-note/assets/js/58.f7911fde.js"><link rel="prefetch" href="/markdown-note/assets/js/59.66850ea7.js"><link rel="prefetch" href="/markdown-note/assets/js/60.0cc12683.js"><link rel="prefetch" href="/markdown-note/assets/js/61.823dd71b.js"><link rel="prefetch" href="/markdown-note/assets/js/62.c778229e.js"><link rel="prefetch" href="/markdown-note/assets/js/63.9ed45b7d.js"><link rel="prefetch" href="/markdown-note/assets/js/64.837e466d.js"><link rel="prefetch" href="/markdown-note/assets/js/65.9ea5ad7a.js"><link rel="prefetch" href="/markdown-note/assets/js/66.d4981cb6.js"><link rel="prefetch" href="/markdown-note/assets/js/67.9b63aafc.js"><link rel="prefetch" href="/markdown-note/assets/js/68.eef5ae8b.js"><link rel="prefetch" href="/markdown-note/assets/js/69.bed8261f.js"><link rel="prefetch" href="/markdown-note/assets/js/7.d036849c.js"><link rel="prefetch" href="/markdown-note/assets/js/70.8811effb.js"><link rel="prefetch" href="/markdown-note/assets/js/71.ef4130a9.js"><link rel="prefetch" href="/markdown-note/assets/js/72.6781bfd3.js"><link rel="prefetch" href="/markdown-note/assets/js/73.c6de1c31.js"><link rel="prefetch" href="/markdown-note/assets/js/74.ec7c5d81.js"><link rel="prefetch" href="/markdown-note/assets/js/75.8d161c81.js"><link rel="prefetch" href="/markdown-note/assets/js/76.97a15235.js"><link rel="prefetch" href="/markdown-note/assets/js/77.85c4a4ed.js"><link rel="prefetch" href="/markdown-note/assets/js/78.92983aca.js"><link rel="prefetch" href="/markdown-note/assets/js/79.a2a42d7d.js"><link rel="prefetch" href="/markdown-note/assets/js/8.0a01bbb8.js"><link rel="prefetch" href="/markdown-note/assets/js/80.3d82ed7f.js"><link rel="prefetch" href="/markdown-note/assets/js/81.2dd53ef0.js"><link rel="prefetch" href="/markdown-note/assets/js/9.d5437aed.js">
    <link rel="stylesheet" href="/markdown-note/assets/css/0.styles.bbfe0b79.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/markdown-note/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link router-link-active">Python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="about" class="dropdown-title"><span class="title">about</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/kogawananari" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/markdown-note/js/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/markdown-note/py/" class="nav-link router-link-active">Python</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="about" class="dropdown-title"><span class="title">about</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/nanarino" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://twitter.com/kogawananari" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Twitter
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>起步</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据类型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>函数</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/markdown-note/py/10-文件处理.html" class="sidebar-link">文件处理</a></li><li><a href="/markdown-note/py/11-日志处理.html" class="sidebar-link">日志处理</a></li><li><a href="/markdown-note/py/12-函数和作用域.html" class="sidebar-link">函数和作用域</a></li><li><a href="/markdown-note/py/13-闭包和装饰器.html" class="sidebar-link">闭包和装饰器</a></li><li><a href="/markdown-note/py/14-递归和深拷贝.html" class="active sidebar-link">递归和深拷贝</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/markdown-note/py/14-递归和深拷贝.html#递归" class="sidebar-link">递归</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/14-递归和深拷贝.html#尾递归" class="sidebar-link">尾递归</a></li><li class="sidebar-sub-header"><a href="/markdown-note/py/14-递归和深拷贝.html#深浅拷贝" class="sidebar-link">深浅拷贝</a></li></ul></li><li><a href="/markdown-note/py/15-迭代器和生成器.html" class="sidebar-link">迭代器和生成器</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面向对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用模块</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>并发编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>WEB相关</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>杂项模块</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="递归和深拷贝"><a href="#递归和深拷贝" class="header-anchor">#</a> 递归和深拷贝</h1> <h2 id="递归"><a href="#递归" class="header-anchor">#</a> 递归</h2> <blockquote><p>在计算机中，函数调用是通过栈（stack）这种数据结构实现的，每当进入一个函数调用，栈就会加一层栈帧，每当函数返回，栈就会减一层栈帧。由于栈的大小不是无限的，所以，递归调用的次数过多，会导致栈溢出。</p></blockquote> <p>递归实例:汉诺塔</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>home <span class="token operator">=</span> <span class="token string">&quot;A柱&quot;</span><span class="token punctuation">,</span>destination <span class="token operator">=</span> <span class="token string">&quot;C柱&quot;</span><span class="token punctuation">,</span>assistance <span class="token operator">=</span> <span class="token string">&quot;B柱&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\t将&quot;</span><span class="token operator">+</span> home <span class="token operator">+</span> <span class="token string">&quot;的最上面的环移动到&quot;</span> <span class="token operator">+</span> destination <span class="token operator">+</span> <span class="token string">&quot;的最上面&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> n<span class="token operator">&gt;</span><span class="token number">1</span> <span class="token punctuation">:</span>
        move<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>home<span class="token punctuation">,</span>assistance<span class="token punctuation">,</span>destination<span class="token punctuation">)</span>
        move<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>home<span class="token punctuation">,</span>destination<span class="token punctuation">,</span>assistance<span class="token punctuation">)</span>
        move<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>assistance<span class="token punctuation">,</span>destination<span class="token punctuation">,</span>home<span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> move<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	将A柱的最上面的环移动到C柱的最上面
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> move<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
	将A柱的最上面的环移动到B柱的最上面
	将A柱的最上面的环移动到C柱的最上面
	将B柱的最上面的环移动到C柱的最上面
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> move<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
	将A柱的最上面的环移动到C柱的最上面
	将A柱的最上面的环移动到B柱的最上面
	将C柱的最上面的环移动到B柱的最上面
	将A柱的最上面的环移动到C柱的最上面
	将B柱的最上面的环移动到A柱的最上面
	将B柱的最上面的环移动到C柱的最上面
	将A柱的最上面的环移动到C柱的最上面
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
</code></pre></div><p>写一个装饰器来探究这个函数开辟了多少个作用域吧</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    step<span class="token operator">=</span><span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">nonlocal</span> step
        step<span class="token operator">+=</span><span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;第%s个函数作用域被开辟&quot;</span><span class="token operator">%</span>step<span class="token punctuation">)</span>
        res<span class="token operator">=</span>func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;第%s个函数作用域被销毁&quot;</span><span class="token operator">%</span>step<span class="token punctuation">)</span>
        step<span class="token operator">-=</span><span class="token number">1</span>
        <span class="token keyword">return</span> res
    <span class="token keyword">return</span> wrapper

@foo
<span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>home <span class="token operator">=</span> <span class="token string">&quot;A柱&quot;</span><span class="token punctuation">,</span>destination <span class="token operator">=</span> <span class="token string">&quot;C柱&quot;</span><span class="token punctuation">,</span>assistance <span class="token operator">=</span> <span class="token string">&quot;B柱&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token number">1</span> <span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;\t将&quot;</span><span class="token operator">+</span> home <span class="token operator">+</span> <span class="token string">&quot;的最上面的环移动到&quot;</span> <span class="token operator">+</span> destination <span class="token operator">+</span> <span class="token string">&quot;的最上面&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> n<span class="token operator">&gt;</span><span class="token number">1</span> <span class="token punctuation">:</span>
        move<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>home<span class="token punctuation">,</span>assistance<span class="token punctuation">,</span>destination<span class="token punctuation">)</span>
        move<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>home<span class="token punctuation">,</span>destination<span class="token punctuation">,</span>assistance<span class="token punctuation">)</span>
        move<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>assistance<span class="token punctuation">,</span>destination<span class="token punctuation">,</span>home<span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> move<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
第<span class="token number">1</span>个函数作用域被开辟
	将A柱的最上面的环移动到C柱的最上面
第<span class="token number">1</span>个函数作用域被销毁
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> move<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
第<span class="token number">1</span>个函数作用域被开辟
第<span class="token number">2</span>个函数作用域被开辟
	将A柱的最上面的环移动到B柱的最上面
第<span class="token number">2</span>个函数作用域被销毁
第<span class="token number">2</span>个函数作用域被开辟
	将A柱的最上面的环移动到C柱的最上面
第<span class="token number">2</span>个函数作用域被销毁
第<span class="token number">2</span>个函数作用域被开辟
	将B柱的最上面的环移动到C柱的最上面
第<span class="token number">2</span>个函数作用域被销毁
第<span class="token number">1</span>个函数作用域被销毁
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> 
<span class="token comment">#由此可见 递归的性能消耗有多大</span>
</code></pre></div><h2 id="尾递归"><a href="#尾递归" class="header-anchor">#</a> 尾递归</h2> <blockquote><p>尾递归是指，在函数返回的时候，调用自身本身，并且，return语句不能包含表达式。这样，编译器或者解释器就可以把尾递归做优化，使递归本身无论调用多少次，都只占用一个栈帧，不会出现栈溢出的情况。</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#一般递归</span>
<span class="token keyword">def</span> <span class="token function">normal_recursion</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> n <span class="token operator">+</span> normal_recursion<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        
<span class="token comment">#尾递归</span>
<span class="token keyword">def</span> <span class="token function">tail_recursion</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> total<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> total
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> tail_recursion<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> total<span class="token operator">+</span>n<span class="token punctuation">)</span>
</code></pre></div><p>最后一步调用,形成&quot;调用栈&quot;<br>
复杂度 O(n) =&gt; O(1)<br>
遗憾的是，大多数编程语言没有针对尾递归做优化，Python解释器也没有做优化，所以，即使把上面的函数改成尾递归方式，也会导致栈溢出。</p> <p>​    但是一个牛人想出的解决办法：</p> <p><code>实现一个 tail_call_optimized 装饰器</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/env python2.4</span>
<span class="token comment"># This program shows off a python decorator(</span>
<span class="token comment"># which implements tail call optimization. It</span>
<span class="token comment"># does this by throwing an exception if it is</span>
<span class="token comment"># it's own grandparent, and catching such</span>
<span class="token comment"># exceptions to recall the stack.</span>

<span class="token keyword">import</span> sys

<span class="token keyword">class</span> <span class="token class-name">TailRecurseException</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> args<span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args
        self<span class="token punctuation">.</span>kwargs <span class="token operator">=</span> kwargs

<span class="token keyword">def</span> <span class="token function">tail_call_optimized</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    This function decorates a function with tail call
    optimization. It does this by throwing an exception
    if it is it's own grandparent, and catching such
    exceptions to fake the tail call optimization.

    This function fails if the decorated
    function recurses in a non-tail context.
    &quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        f <span class="token operator">=</span> sys<span class="token punctuation">.</span>_getframe<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> f<span class="token punctuation">.</span>f_back <span class="token keyword">and</span> f<span class="token punctuation">.</span>f_back<span class="token punctuation">.</span>f_back \
            <span class="token keyword">and</span> f<span class="token punctuation">.</span>f_back<span class="token punctuation">.</span>f_back<span class="token punctuation">.</span>f_code <span class="token operator">==</span> f<span class="token punctuation">.</span>f_code<span class="token punctuation">:</span>
            <span class="token comment"># 抛出异常</span>
            <span class="token keyword">raise</span> TailRecurseException<span class="token punctuation">(</span>args<span class="token punctuation">,</span> kwargs<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token keyword">return</span> g<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
                <span class="token keyword">except</span> TailRecurseException<span class="token punctuation">,</span> e<span class="token punctuation">:</span>
                    args <span class="token operator">=</span> e<span class="token punctuation">.</span>args
                    kwargs <span class="token operator">=</span> e<span class="token punctuation">.</span>kwargs
    func<span class="token punctuation">.</span>__doc__ <span class="token operator">=</span> g<span class="token punctuation">.</span>__doc__
    <span class="token keyword">return</span> func

@tail_call_optimized
<span class="token keyword">def</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> acc<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">&quot;calculate a factorial&quot;</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> acc
    <span class="token keyword">return</span> factorial<span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token operator">*</span>acc<span class="token punctuation">)</span>

<span class="token keyword">print</span> factorial<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> 
</code></pre></div><p>原文<a href="http://code.activestate.com/recipes/474088-tail-call-optimization-decorator/" target="_blank" rel="noopener noreferrer">http://code.activestate.com/recipes/474088-tail-call-optimization-decorator/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="深浅拷贝"><a href="#深浅拷贝" class="header-anchor">#</a> 深浅拷贝</h2> <p>浅拷贝</p> <div class="language-python extra-class"><pre class="language-python"><code>l2 <span class="token operator">=</span> l1
</code></pre></div><p>对于赋值运算来说,2个列表名,指向的是同一个内存地址，所以他们是完全一样的。</p> <div class="language-python extra-class"><pre class="language-python"><code>l2 <span class="token operator">=</span> l1<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>对于浅copy来说，只是在内存中重新创建了开辟了一个空间存放一个新列表，但是新列表中的元素与原列表中的元素是公用的。</p> <h3 id="借助copy模块"><a href="#借助copy模块" class="header-anchor">#</a> 借助copy模块</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> copy
l2 <span class="token operator">=</span> copy<span class="token punctuation">.</span>deepcopy<span class="token punctuation">(</span>l1<span class="token punctuation">)</span>
</code></pre></div><p>对于深copy来说，列表是在内存中重新创建的，列表中可变的数据类型是重新创建的，列表中的不可变的数据类型是公用的。</p> <blockquote><h5 id="如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。"><a href="#如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。" class="header-anchor">#</a> 如果需要自己写一个函数来实现深拷贝，那么可以通过递归实现。</h5> <div class="language-python extra-class"><pre class="language-python"><code>dt <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;aaa&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;bbb&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;c1&quot;</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">&quot;c2&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;c21&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;211&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c22&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;212&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c23&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;213&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;c3&quot;</span><span class="token punctuation">:</span> <span class="token number">33</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">copy_dict</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> d<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 如果不是dict字典，则直接赋值</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
        <span class="token comment"># 如果还是字典，递归调用copy_dict(d)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> copy_dict<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;复制前：&quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span><span class="token punctuation">)</span>
copy_dt <span class="token operator">=</span> copy_dict<span class="token punctuation">(</span>dt<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;复制后：&quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>copy_dict<span class="token punctuation">(</span>dt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/markdown-note/py/13-闭包和装饰器.html" class="prev">闭包和装饰器</a></span> <span class="next"><a href="/markdown-note/py/15-迭代器和生成器.html">迭代器和生成器</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/markdown-note/assets/js/app.a730857b.js" defer></script><script src="/markdown-note/assets/js/6.4d707832.js" defer></script><script src="/markdown-note/assets/js/1.19267a43.js" defer></script><script src="/markdown-note/assets/js/54.7dafa28e.js" defer></script>
  </body>
</html>
